# Speech_to_ASL
本项目旨在实现将语音输入转化为对应美国手语演示视频，然后播放。

##本次项目解决了什么需求？

当你想传达信息给一个不会打字的使用美国手语的聋哑人，你可以通过语音输入，让app转换出相应的手语视频动画进行告知，后期待app扩展出反向的转换功能，即可实现与使用美国手语的聋哑人无障碍沟通。


##为什么不直接实现对中国手语的转换？

主要有以下2点考虑：
①资源支持。美国手语有较为完整标准的资源库，如https://www.signingsavvy.com。而中国手语公开资源稀少，现有数据集（如NationalCSL-DP）仅包含6,707个手势动作（约13.4万视频）。
②转换难度。美国手语的语法较为简单，通常以“主题—评论”的形式展现，因而从英文句子解析为美国手语语法的句子是较为容易实现的。而中国手语需解决分词歧义、多义词消解等问题，不容易实现转换。


##使用注意事项：

运行项目前需要配置自己的百度翻译api的appid和密钥，在BaiduTranslator.kt的代码注释中已详细说明了如何配置；手机要有Google服务框架，需要在Google play商店安装Google（使用的是它的语音服务）；Google要打开麦克风权限，项目apk要打开麦克风权限，且要连接上vpn。此外经过测试，华为手机中要在设置->默认应用->辅助应用和语音输入，语音输入选Google语音服务，辅助应用改成Google才能使用


##项目数据流：语音→文本→翻译文本→>ASL语法文本→爬取视频->播放视频


##项目整体实现流程：

首先将语音输入转成文字，这里统一使用了Google的语音服务。使用时需要手机上安装好Google这个应用，才能够使用到Google语音服务，如果没有安装，打开APK时会提示跳转安装。
然后使用百度翻译的API（https://api.fanyi.baidu.com/product/11）。将这个语音转文字的结果翻译成英文。因为我们这个项目是把语音输入最终转成这个美国手语ASL的视频动画，所以需要将这个文本结果翻译成英文。
因为美国手语的对应的句子是有区别于普通英文的语法结构，所以要先把翻译出来的英文句子转换成ASL语法结构的句子才能进行下一步。我们需要先知道英语句子的每一个词对应是什么词性才可以进行这些调整，也就是要先对每个词进行词性标注。
接下来我们根据AI的指引，用斯坦福自然语言处理的这个专门用于英文句子的句法解析的模型来解析这个英文句子，得到它每个词的词性。它的基本原理是这个模型中相当于涵盖了所有英文句子的可能的结构，它寻找最大概率匹配我们的英文句子的结构，基于这个结构它就能对每个词进行词性标注。然后就可以根据每个词的词性进行句子的调整，把英文句子转换成ASL语法结构的句子。
最后把刚才得到的这个具有ASL语法的句子分割成一个个单词，再把每个单词作为关键词在美国手语动画演示的网站https://www.signingsavvy.com上爬取它对应的视频动画，接着把每个视频下载到临时目录，下载完成后一个个按顺序播放出来，播放完成之后也可以点击重新播放，或者重新开始录音进行下一次语音-手语视频转换。


##项目主要运行逻辑：

整个app分为三部分，上方显示文本和翻译文本，中间显示视频、ASL语法文本和重播键，下方提供录音键和确认取消键。
用户点击录音键讲话后，app会把语音转为文本并显示再进行翻译显示，如果用户点击取消，会回到初始状态；如果用户点击确定，app会把翻译的文本转化为ASL语法文本，根据这个ASL文本去爬取翻译文本中每个单词的手语视频，加载到app中进行视频播放，同时视频下方显示ASL文本，视频播放完毕后可以点击重播键进行重播，也可以再次点击录音进行下一次转换。



##各个模块实现细节：

##检查相关（Checker.kt）：

1、检查当前设备网络是否可用。该方法主要用于点击开始录音时检查网络情况。
2、检查设备上Google语音识别服务是否可用。创建一个用于语音识别的 Intent，通过查询是否存在能够处理该Intent 的活动来检测 Google 语音服务是否可用，MATCH_DEFAULT_ONLY 参数标志表示确保找到的是默认处理程序，所以部分设备安装Google后需要在设置中将语音输入的辅助应用选择成Google（如华为）。若Google语音服务不可用，设置提醒引导用户安装。
3、检查设备是否是华为设备。该方法主要用于提醒用户需进行额外配置将语音输入的辅助应用选择成Google。



##语音相关（SpeechHelper.kt）：

1、检查录音权限授予状态，若已授予，开始录音；若未授予，请求录音权限，若接受录音权限开启，开始录音，若拒绝录音权限开启，显示提示框跳转设置。
2、语音识别器的初始化。创建语音识别器实例speechRecognizer，用于启动和管理语音识别会话，设置语音识别监听器，处理语音识别的各个阶段的事件（如识别结果、错误等）。识别结果onResults回调中，将onResults回调是否触发的标志位置为1，变量lastResult保存最新录音转文本结果，接着判断手动停止录音标志位是否为1，如果是，显示文本结果，更新UI显示（状态改变、确认和取消按钮的显示），调用百度翻译api，显示翻译结果。
3、开始录音方法。首先检查网络连接情况，接着创建语音识别的Intent，指定处理该Intent的应用包名，强制使用Google语音搜索应用。开始录音时更新界面UI和重置标志位，然后释放上一次的播放器资源exoPlayer，然后重新初始化ExoPlayer，最后speechRecognizer启动语音识别。
4、停止录音方法。改变对应标志位，更新UI，判断onResults回调是否触发的标志位是否为1，如果是，表明已经停止语音识别，onResults回调已经被自动触发，所以显示语音文本结果，更新UI显示，调用百度翻译api，显示翻译结果；如果onResults回调还没触发，主动停止语音识别speechRecognizer.stopListening()。
细节：之所以要用到onResults回调是否触发的标志位和手动停止录音标志位，是因为语音识别时，如果说完一句话后静音一段时间，语音识别会自动停止，直接显示语音转文字结果，而不是点击停止录音后才显示文字结果。



##百度翻译（BaiduTranslator.kt）：

使用百度通用文本翻译的api，在百度翻译平台中开通通用文本翻译服务，获取该应用的app_id和密钥，并将其配置在local.properties文件中。在该类的translate方法中，首先生成盐值和md5签名，创建请求对象，指定请求 URL 和请求方法为 POST，使用 OkHttpClient 在后台线程发送请求到百度翻译 API，解析响应的 JSON 数据，从JSON数据中提取翻译结果，将翻译结果封装为成功或失败的 Result 对象并传递给回调函数，初始化语音助手类时translateText是匿名函数，它调用了百度翻译API，使用了嵌套回调，将最后翻译的结果在语音助手类中的函数显示。


##转换为ASL语法结构的文本（asl软件包）：

ASL的语法跟一般的英语句子有很大的不同，比如，在ASL中，时间要前置，而且会先强调描述的对象，再说明相应的动作、形容，而且ASL也没有介词、冠词等词性，也没有复数，也没有时态。
在ai的指引下，我们发现可以这样实现ASL的转换:将英语句子的每个单词打上词性标注，然后根据其词性标注作删除、修改和语序转换。我们使用的是斯坦福的自然语言解析器，它能将输入的句子进行词性标注，得到标注后的结果后，我们对结果调用各种语法的调整函数，最后以空格为间隔拼接所有单词，返回ASI句子。



##爬取视频（Grabber.kt）：

根据输入的ASI文本，以空格分割获取每个单词，将单词拼接到手语网站的搜索链接，使用第三方工具Jsoup，根据链接获取到对应链接的html文档，从根结点逐层向下展开找到视频的下载链接，收集下载链接，最后将结果汇总返回。
细节：
1、对于有歧义的单词，也就是有多个搜索结果的，这里作简化处理，只返回第一个。
2、对于搜索不到的单词，会按字母逐个拆分获取对应视频。


##下载且播放视频（VideoHelper.kt）：

在当前项目的缓存目录下新建一个临时的视频存储目录，用于存放每个单词对应的手语视频，根据获取到的视频下载链接列表，使用第三方工具okHttp，向网站发送http请求，获取http响应体，将响应体中的视频进制数据转化为字节流，使用文件输入输出流将其读并写到对应的文件，并返回文件的绝对路径。
遍历处理好的视频文件绝对路径，使用第三方工具exoplayer来解析视频二进制代码进行视频播放，每次播放会挂起协程，对每个视频进行监听，播放完才恢复协程，顺序播放。
每个视频，播放完会回到主线程。此外，视频文件的绝对路径在主活动中也进行了保存，可用于视频重播。
细节:调用这个视频解析函数时还进行了进度的回调，每解析完一个视频会进行进度的更新。

##实际效果演示：

<img width="214" alt="1" src="https://github.com/user-attachments/assets/c1660745-f51f-4da7-a73a-5f28d8e882ea" />

<img width="208" alt="2" src="https://github.com/user-attachments/assets/7631c4f5-6396-43f4-9736-b05028e95b50" />

<img width="209" alt="3" src="https://github.com/user-attachments/assets/a08e1db0-1700-40bc-acb0-6fab26884ced" />

<img width="208" alt="4" src="https://github.com/user-attachments/assets/9375554d-8f60-4e41-ada1-c29e39808daa" />
